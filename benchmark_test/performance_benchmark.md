# 性能指标

## 环境

**CPU**: Intel(R) Core(TM) i7-8700 CPU @ 3.20GHz  (12 Cores)

**GPU**: GeForce GTX 1060 6GB  、 GeForce GTX 1660 6GB

## 数据

本次测试所使用的数据集为 SIFT1B ，共有十亿条128维的向量。关于该数据集的详细信息请参考：http://corpus-texmex.irisa.fr/。

## 说明

本文中用到的一些符号及专用名词说明如下：

| 专用名词 | 解释                                     |
| -------- | ---------------------------------------- |
| nq       | 查询的目标向量条目数，在搜索时定义。     |
| topk     | 与查询的目标向量最相似的 topk 个结果。   |
| time     | 批量查询时的总查询时间                   |
| nprobe   | 查询时需要搜索的分桶数目，在搜索时定义。 |

（注：测试性能与nprobe值相关，性能随着nprobe增大而降低，但是精确率会随之增加。用户可根据具体场景要求设置nprobe. ）

各类型索引如何选择可参考：https://milvus.io/cn/blogs/2019-12-03-select-index.md

测试参数设置：nlist=4096, index_file_size=2048

## 测试结果

[sift1m测试结果](performance_benchmark.md#sift1m): 该测试中，选取了sift1B数据集中的前1,000,000条向量。

[sift10m测试结果](performance_benchmark.md#sift10m): 该测试中，选取了sift1B数据集中的前10,000,000条向量。

[sift100m测试结果](performance_benchmark.md#sift100m): 该测试中，选取了sift1B数据集中的前100,000,000条向量。

本次测试过程中，数据每10万为一个批次导入milvus中，10万条128维的向量**导入约耗时**：0.7S。

## sift1m

##### 索引：ivf_sq8

(索引建立耗时：14s)

(nprobe:256)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 97.6%  | 97.0%  | 97.2%  |
| topk=10  | 96.2%  | 95.7%  | 95.8%  |
| topk=100 | 93.0%  | 92.4%  | 92.8%  |
| topk=500 | 87.8%  | 87.1%  | 87.4%  |

**性能：**

(cpu查询)

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.0036 | 0.0034  | 0.0037   | 0.0043   |
| nq=10   | 0.0099 | 0.0101  | 0.0106   | 0.0122   |
| nq=100  | 0.0499 | 0.0508  | 0.0556   | 0.0703   |
| nq=500  | 0.2356 | 0.2351  | 0.2567   | 0.439    |
| nq=1000 | 0.557  | 0.56    | 0.7726   | 0.9335   |



##### 索引ivf_sq8h

(索引建立耗时：10s)

(nprobe:64)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 97.8%  | 97.0%  | 97.2%  |
| topk=10  | 96.6%  | 96.1%  | 96.7%  |
| topk=100 | 92.8%  | 92.7%  | 92.9%  |
| topk=500 | 87.6%  | 87.0%  | 86.8%  |


**性能：**

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.003  | 0.0028 | 0.0029 | 0.0033 |
| nq=10   | 0.0062 | 0.0058 | 0.0059 | 0.0066 |
| nq=100  | 0.0288 | 0.0299 | 0.0337 | 0.0413 |
| nq=500  | 0.1252 | 0.1239 | 0.1313 | 0.174  |
| nq=1000 | 0.2274 | 0.23   | 0.2514 | 0.3418 |




## sift10m

##### 索引：ivf_sq8

(索引建立耗时：138s)

(nprobe:128)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 97.2%  | 97.6%  | 97.2%  |
| topk=10  | 98.2%  | 98.0%  | 97.8%  |
| topk=100 | 98.4%  | 98.9%  | 97.7%  |
| topk=500 | 97.7%  | 97.1%  | 97.3%  |

**性能：**

(cpu查询)

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.0048 | 0.0054  | 0.0057   | 0.0044   |
| nq=10   | 0.0433 | 0.0431  | 0.0442   | 0.0466   |
| nq=100  | 0.2653 | 0.2975  | 0.3053   | 0.2312   |
| nq=500  | 1.4938 | 1.4782 | 1.4198 | 1.5075 |
| nq=1000 | 2.9571 | 3.0626 | 3.1267 | 3.2935 |



##### 索引：ivf_sq8h

(nprobe:128)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 97.0%  | 96.2%  | 98.0%  |
| topk=10  | 96.6%  | 97.3%  | 96.3%  |
| topk=100 | 95.7%  | 95.9%  | 95.6%  |
| topk=500 | 92.8%  | 93.3%  | 92.8%  |

**性能：**

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.0051 | 0.0047 | 0.0048 | 0.006  |
| nq=10   | 0.0199 | 0.02   | 0.0201 | 0.0212 |
| nq=100  | 0.1306 | 0.1263 | 0.1252 | 0.1379 |
| nq=500  | 0.5227 | 0.5162 | 0.5058 | 0.6032 |
| nq=1000 | 0.9893 | 0.9907 | 0.9995 | 1.1486 |



## sift100m

##### 索引：ivf_sq8

(索引建立耗时：229s)

(nprobe:64)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 96.6%  | 96.8%  | 96.6%  |
| topk=10  | 96.5%  | 96.6%  | 96.2%  |
| topk=100 | 94.8%  | 95.2%  | 94.8%  |
| topk=500 | 92.6%  | 92.8%  | 92.6%  |



**性能：**

(cpu查询)

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.0194 | 0.0193 | 0.0203 | 0.0237 |
| nq=10   | 0.1592 | 0.1596 | 0.1632 | 0.1708 |
| nq=100  | 0.8353 | 0.8549 | 0.8732 | 0.9299 |
| nq=500  | 3.7656 | 3.7797 | 3.875  | 4.2264 |
| nq=1000 | 7.1181 | 6.9993 | 7.2212 | 7.7575 |

##### 索引ivf_sq8h

(nprobe:64)

**准确率：**

本处从待查询向量集中随机取出了500条向量查询，召回率取这500条结果的平均值，一共测试三次，每次取出的500条向量不完全相同。

| accuracy | 第一次 | 第二次 | 第三次 |
| -------- | ------ | ------ | ------ |
| topk=1   | 96.8%  | 96.0%  | 96.4%  |
| topk=10  | 96.3%  | 95.8%  | 96.2%  |
| topk=100 | 95.5%  | 94.9%  | 95.3%  |
| topk=500 | 93.5%  | 92.4%  | 92.9%  |

**性能：**

| time(S) | topk=1 | topk=10 | topk=100 | topk=500 |
| ------- | ------ | ------- | -------- | -------- |
| nq=1    | 0.0193 | 0.0195 | 0.0204 | 0.024  |
| nq=10   | 0.0856 | 0.0857 | 0.086  | 0.092  |
| nq=100  | 0.5063 | 0.5042 | 0.5212 | 0.6316 |
| nq=500  | 2.3709 | 2.3793 | 2.4304 | 2.6234 |
| nq=1000 | 4.3712 | 4.3877 | 4.4647 | 4.8881 |
